{% extends "base.html" %}

{% block title %}ì¥í•´ë“±ê¸‰ ì˜ˆì¸¡ ê²°ê³¼ - SANZERO{% endblock %}

{% block head %}
<meta name="description" content="{{ description }}">
<!-- ê²°ê³¼ í˜ì´ì§€ ì „ìš© ìŠ¤íƒ€ì¼ -->
<style>
.result-container {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 20px;
    padding: 3rem;
    color: white;
    margin-bottom: 2rem;
    text-align: center;
    position: relative;
    overflow: hidden;
}

.result-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    z-index: 1;
}

.result-content {
    position: relative;
    z-index: 2;
}

.grade-display {
    font-size: 4rem;
    font-weight: bold;
    margin: 1rem 0;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
}

.grade-1-3 {
    color: #ff6b6b;
    text-shadow: 0 0 20px rgba(255, 107, 107, 0.8);
}

.grade-4-7 {
    color: #ffa726;
    text-shadow: 0 0 20px rgba(255, 167, 38, 0.8);
}

.grade-8-12 {
    color: #66bb6a;
    text-shadow: 0 0 20px rgba(102, 187, 106, 0.8);
}

.grade-13-15 {
    color: #42a5f5;
    text-shadow: 0 0 20px rgba(66, 165, 245, 0.8);
}

.confidence-bar {
    background: rgba(255, 255, 255, 0.2);
    border-radius: 10px;
    height: 20px;
    margin: 1rem 0;
    overflow: hidden;
}

.confidence-fill {
    background: linear-gradient(45deg, #4caf50, #8bc34a);
    height: 100%;
    border-radius: 10px;
    transition: width 1s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8rem;
    font-weight: bold;
    color: white;
}

.result-details {
    background: white;
    border-radius: 16px;
    padding: 2rem;
    margin: 2rem 0;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
}

.detail-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin: 1.5rem 0;
}

.detail-card {
    background: #f8f9ff;
    border: 1px solid #e2e8f0;
    border-radius: 12px;
    padding: 1.5rem;
}

.detail-card h4 {
    margin: 0 0 1rem 0;
    color: #4a5568;
    font-size: 1.1rem;
    font-weight: bold;
}

.detail-card p {
    margin: 0.5rem 0;
    color: #718096;
    line-height: 1.5;
}

.source-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    background: rgba(255, 255, 255, 0.2);
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-size: 0.9rem;
    font-weight: 500;
    margin: 1rem 0;
}

.actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
    margin: 2rem 0;
}

.action-btn {
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    text-decoration: none;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

.btn-primary {
    background: linear-gradient(45deg, #667eea, #764ba2);
    color: white;
}

.btn-secondary {
    background: white;
    color: #667eea;
    border: 2px solid #667eea;
}

.btn-success {
    background: linear-gradient(45deg, #4caf50, #66bb6a);
    color: white;
}

.action-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
}

.warning-box {
    background: #fff3cd;
    border: 1px solid #ffeaa7;
    border-radius: 12px;
    padding: 1.5rem;
    margin: 2rem 0;
}

.warning-box h4 {
    color: #856404;
    margin: 0 0 1rem 0;
    font-weight: bold;
}

.warning-box p {
    color: #856404;
    margin: 0;
    line-height: 1.6;
}

.grade-info {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 1.5rem;
    margin: 1.5rem 0;
}

.grade-scale {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 1rem 0;
    font-size: 0.9rem;
}

.scale-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    opacity: 0.7;
}

.scale-item.current {
    opacity: 1;
    transform: scale(1.2);
}

.scale-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    margin-bottom: 0.5rem;
}

@media (max-width: 768px) {
    .result-container {
        padding: 2rem 1rem;
    }

    .grade-display {
        font-size: 3rem;
    }

    .detail-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
    }

    .actions {
        flex-direction: column;
        align-items: center;
    }

    .action-btn {
        width: 100%;
        max-width: 280px;
        justify-content: center;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-4xl">
    <!-- ë’¤ë¡œ ê°€ê¸° ë²„íŠ¼ -->
    <div class="mb-6">
        <a href="/" class="inline-flex items-center text-blue-600 hover:text-blue-800 transition-colors">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
            ë©”ì¸ ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
        </a>
    </div>

    <!-- ê²°ê³¼ ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <div class="result-container">
        <div class="result-content">
            <h1 class="text-3xl font-bold mb-4">ğŸ¯ ì¥í•´ë“±ê¸‰ ì˜ˆì¸¡ ê²°ê³¼</h1>

            <div id="resultDisplay">
                <!-- ê²°ê³¼ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤ -->
                <div class="text-xl opacity-80 mb-4">ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            </div>

            <div class="source-badge" id="sourceBadge" style="display: none;">
                <span id="sourceIcon">ğŸ”</span>
                <span id="sourceText">ì˜ˆì¸¡ ë°©ë²•</span>
            </div>

            <!-- ì‹ ë¢°ë„ í‘œì‹œ -->
            <div id="confidenceSection" style="display: none;">
                <p class="text-lg mb-2">ì˜ˆì¸¡ ì‹ ë¢°ë„</p>
                <div class="confidence-bar">
                    <div class="confidence-fill" id="confidenceFill" style="width: 0%;">
                        <span id="confidenceText">0%</span>
                    </div>
                </div>
            </div>

            <!-- ë“±ê¸‰ ì •ë³´ -->
            <div class="grade-info" id="gradeInfo" style="display: none;">
                <h3 class="text-xl font-bold mb-3">ì¥í•´ë“±ê¸‰ ë¶„ë¥˜</h3>
                <div class="grade-scale">
                    <div class="scale-item" data-grade-range="1-3">
                        <div class="scale-dot bg-red-400"></div>
                        <span>1-3ê¸‰<br>ì¤‘ì¦</span>
                    </div>
                    <div class="scale-item" data-grade-range="4-7">
                        <div class="scale-dot bg-orange-400"></div>
                        <span>4-7ê¸‰<br>ì¤‘ë“±ë„</span>
                    </div>
                    <div class="scale-item" data-grade-range="8-12">
                        <div class="scale-dot bg-green-400"></div>
                        <span>8-12ê¸‰<br>ê²½ë„</span>
                    </div>
                    <div class="scale-item" data-grade-range="13-15">
                        <div class="scale-dot bg-blue-400"></div>
                        <span>13-15ê¸‰<br>ê²½ë¯¸</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ê²°ê³¼ ìƒì„¸ ì •ë³´ -->
    <div class="result-details">
        <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">ğŸ“‹ ì˜ˆì¸¡ ìƒì„¸ ì •ë³´</h2>

        <div class="detail-grid">
            <div class="detail-card">
                <h4>ğŸ¯ ì˜ˆì¸¡ ë“±ê¸‰</h4>
                <p id="gradeDetail">ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>

            <div class="detail-card">
                <h4>ğŸ” ì˜ˆì¸¡ ë°©ë²•</h4>
                <p id="methodDetail">ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>

            <div class="detail-card">
                <h4>ğŸ“Š ì‹ ë¢°ë„</h4>
                <p id="confidenceDetail">ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>

            <div class="detail-card">
                <h4>ğŸ“ ì˜ˆì¸¡ ê·¼ê±°</h4>
                <p id="explanationDetail">ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>
        </div>
    </div>

    <!-- ì£¼ì˜ì‚¬í•­ -->
    <div class="warning-box">
        <h4>âš ï¸ ì¤‘ìš”í•œ ì£¼ì˜ì‚¬í•­</h4>
        <p>
            ì´ ì˜ˆì¸¡ ê²°ê³¼ëŠ” AI ë¶„ì„ì„ í†µí•œ <strong>ì°¸ê³ ìš© ì •ë³´</strong>ì…ë‹ˆë‹¤.
            ì‹¤ì œ ì¥í•´ë“±ê¸‰ì€ ì˜ë£Œì§„ì˜ ì •ë°€ ì§„ë‹¨ê³¼ ì‚°ì¬ë³´í—˜ ì‹¬ì‚¬ìœ„ì›íšŒì˜ ì¢…í•©ì ì¸ ê²€í† ë¥¼ í†µí•´ ê²°ì •ë©ë‹ˆë‹¤.
            ì •í™•í•œ ì§„ë‹¨ê³¼ ë“±ê¸‰ ê²°ì •ì„ ìœ„í•´ì„œëŠ” ë°˜ë“œì‹œ ì˜ë£Œì§„ê³¼ ìƒë‹´í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.
        </p>
    </div>

    <!-- ë‹¤ìŒ ë‹¨ê³„ ì•ˆë‚´ -->
    <div class="actions">
        <a href="/compensation/calculator" class="action-btn btn-primary">
            ğŸ’° ë³´ìƒê¸ˆ ê³„ì‚°í•˜ê¸°
        </a>
        <a href="/analysis/disability" class="action-btn btn-secondary">
            ğŸ”„ ë‹¤ì‹œ ì˜ˆì¸¡í•˜ê¸°
        </a>
    </div>
</div>

<script>
// URL íŒŒë¼ë¯¸í„°ì—ì„œ ê²°ê³¼ ë°ì´í„° ì¶”ì¶œ
const urlParams = new URLSearchParams(window.location.search);
const grade = urlParams.get('grade');
const confidence = urlParams.get('confidence');
const source = urlParams.get('source');
const message = urlParams.get('message');

function displayResult() {
    const resultDisplay = document.getElementById('resultDisplay');
    const sourceBadge = document.getElementById('sourceBadge');
    const confidenceSection = document.getElementById('confidenceSection');
    const gradeInfo = document.getElementById('gradeInfo');

    if (grade && grade !== 'N/A') {
        // ë“±ê¸‰ë³„ ìŠ¤íƒ€ì¼ í´ë˜ìŠ¤ ê²°ì •
        let gradeClass = '';
        const gradeNum = parseInt(grade);
        if (gradeNum <= 3) gradeClass = 'grade-1-3';
        else if (gradeNum <= 7) gradeClass = 'grade-4-7';
        else if (gradeNum <= 12) gradeClass = 'grade-8-12';
        else gradeClass = 'grade-13-15';

        // ê²°ê³¼ í‘œì‹œ
        resultDisplay.innerHTML = `
            <div class="grade-display ${gradeClass}">${grade}ê¸‰</div>
            <p class="text-xl mb-4">${message || `ì¥í•´ë“±ê¸‰ ${grade}ê¸‰ìœ¼ë¡œ ì˜ˆì¸¡ë©ë‹ˆë‹¤`}</p>
        `;

        // ì†ŒìŠ¤ ë°°ì§€ í‘œì‹œ
        if (source) {
            const sourceIcon = getSourceIcon(source);
            const sourceText = getSourceText(source);
            document.getElementById('sourceIcon').textContent = sourceIcon;
            document.getElementById('sourceText').textContent = sourceText;
            sourceBadge.style.display = 'inline-flex';
        }

        // ì‹ ë¢°ë„ í‘œì‹œ
        if (confidence) {
            const confidencePercent = Math.round(parseFloat(confidence) * 100);
            document.getElementById('confidenceText').textContent = `${confidencePercent}%`;
            document.getElementById('confidenceFill').style.width = `${confidencePercent}%`;
            confidenceSection.style.display = 'block';
        }

        // ë“±ê¸‰ ìŠ¤ì¼€ì¼ì—ì„œ í˜„ì¬ ìœ„ì¹˜ í‘œì‹œ
        const scaleItems = document.querySelectorAll('.scale-item');
        scaleItems.forEach(item => {
            const range = item.dataset.gradeRange;
            if (isGradeInRange(gradeNum, range)) {
                item.classList.add('current');
            }
        });

        gradeInfo.style.display = 'block';

        // ìƒì„¸ ì •ë³´ ì—…ë°ì´íŠ¸
        updateDetailCards(grade, source, confidence, message);

    } else {
        // ì˜¤ë¥˜ í‘œì‹œ
        resultDisplay.innerHTML = `
            <div class="text-2xl text-red-300 mb-4">âŒ ì˜ˆì¸¡ ì‹¤íŒ¨</div>
            <p class="text-lg">${message || 'ì˜ˆì¸¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤'}</p>
        `;
    }
}

function getSourceIcon(source) {
    const icons = {
        'exact_match': 'ğŸ¯',
        'similarity_match': 'ğŸ”',
        'regression_model': 'ğŸ¤–',
        'fallback': 'âš™ï¸',
        'error': 'âŒ'
    };
    return icons[source] || 'ğŸ”';
}

function getSourceText(source) {
    const texts = {
        'exact_match': 'ì •í™• ë¬¸êµ¬ ë§¤ì¹­',
        'similarity_match': 'BERT ìœ ì‚¬ë„ ë§¤ì¹­',
        'regression_model': '2-Stage ë¨¸ì‹ ëŸ¬ë‹',
        'fallback': 'ê·œì¹™ ê¸°ë°˜ ì˜ˆì¸¡',
        'error': 'ì˜ˆì¸¡ ì˜¤ë¥˜'
    };
    return texts[source] || 'ì•Œ ìˆ˜ ì—†ìŒ';
}

function isGradeInRange(grade, range) {
    const [min, max] = range.split('-').map(n => parseInt(n));
    return grade >= min && grade <= max;
}

function updateDetailCards(grade, source, confidence, message) {
    document.getElementById('gradeDetail').textContent =
        grade ? `${grade}ê¸‰ (${getGradeDescription(parseInt(grade))})` : 'ì˜ˆì¸¡ ì‹¤íŒ¨';

    document.getElementById('methodDetail').textContent =
        source ? getSourceText(source) : 'ì•Œ ìˆ˜ ì—†ìŒ';

    const confidencePercent = confidence ? Math.round(parseFloat(confidence) * 100) : 0;
    document.getElementById('confidenceDetail').textContent =
        `${confidencePercent}% (${getConfidenceDescription(confidencePercent)})`;

    document.getElementById('explanationDetail').textContent =
        message || 'ì˜ˆì¸¡ ê·¼ê±° ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.';
}

function getGradeDescription(grade) {
    if (grade <= 3) return 'ì¤‘ì¦ ì¥ì• ';
    if (grade <= 7) return 'ì¤‘ë“±ë„ ì¥ì• ';
    if (grade <= 12) return 'ê²½ë„ ì¥ì• ';
    return 'ê²½ë¯¸í•œ ì¥ì• ';
}

function getConfidenceDescription(confidence) {
    if (confidence >= 90) return 'ë§¤ìš° ë†’ìŒ';
    if (confidence >= 70) return 'ë†’ìŒ';
    if (confidence >= 50) return 'ë³´í†µ';
    if (confidence >= 30) return 'ë‚®ìŒ';
    return 'ë§¤ìš° ë‚®ìŒ';
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ê²°ê³¼ í‘œì‹œ
document.addEventListener('DOMContentLoaded', displayResult);
</script>
{% endblock %}